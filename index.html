<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Crystal Clicker: Evolution</title>
    <link href="https://fonts.googleapis.com" rel="stylesheet">
    <style>
        :root { --neon: #00f2ff; --gold: #f1c40f; }
        body { background: #050505; color: white; font-family: 'Orbitron', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Welt-Sektion */
        #world-section { flex: 1.2; display: flex; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle, #001a33, #000); position: relative; border-right: 2px solid #222; }
        #earth-container { position: relative; width: 300px; height: 300px; }
        #earth { width: 100%; height: 100%; border-radius: 50%; background: #1a1a1a; box-shadow: inset 0 0 50px rgba(0,0,0,0.9); cursor: pointer; position: relative; overflow: hidden; transition: transform 0.1s; border: 2px solid #333; z-index: 5; }
        #earth:active { transform: scale(0.95); }
        
        /* Visuelle Upgrades auf der Erde */
        .visual-element { position: absolute; pointer-events: none; z-index: 10; transition: opacity 0.5s; }
        .ocean-layer { position: absolute; width: 100%; height: 100%; background: rgba(0, 119, 255, 0.4); border-radius: 50%; top: 0; left: 0; opacity: 0; }
        .tree { font-size: 20px; }
        .cloud { font-size: 24px; filter: blur(1px); opacity: 0.8; }

        /* Merge-Feld */
        #merge-section { flex: 1.5; padding: 20px; text-align: center; }
        #grid { display: grid; grid-template-columns: repeat(4, 85px); gap: 12px; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 20px; }
        .slot { width: 85px; height: 85px; background: rgba(0,0,0,0.3); border: 1px solid #333; border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; }
        .slot:hover { border-color: var(--neon); }

        /* Dynamische Kristall-Formen */
        .crystal { position: relative; transition: all 0.3s; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; text-shadow: 0 0 5px black; }

        /* Upgrade Panel */
        #upgrade-section { flex: 1.3; background: #0a0a0a; padding: 20px; overflow-y: auto; border-left: 2px solid #222; }
        .upgrade-card { background: #151515; border: 1px solid #333; padding: 12px; margin-bottom: 10px; border-radius: 10px; cursor: pointer; }
        .upgrade-card:hover { border-color: var(--neon); }
        .upgrade-card.locked { opacity: 0.3; pointer-events: none; }
        .price { color: var(--gold); font-size: 14px; }
        
        .stat-bar { background: rgba(0,0,0,0.5); padding: 15px; border-radius: 10px; width: 80%; margin-bottom: 20px; }
    </style>
</head>
<body>

<div id="world-section">
    <div class="stat-bar">
        <div id="money-display" style="color: var(--gold); font-size: 28px;">0 ü™ô</div>
        <div id="gps-display" style="color: var(--neon);">Produktion: 0/s</div>
    </div>
    <div id="earth-container">
        <div id="earth" onclick="clickEarth(event)">
            <div id="ocean" class="ocean-layer"></div>
        </div>
        <div id="visual-overlay"></div>
    </div>
    <h2 id="world-name">LEBENSZEIT: STUFE 0</h2>
</div>

<div id="merge-section">
    <h3>KRISTALL-MODULATOR</h3>
    <div id="grid"></div>
    <button id="buy-btn" onclick="buyCrystal()" style="width: 100%; margin-top: 20px; padding: 15px; background: var(--neon); border: none; cursor: pointer; font-family: 'Orbitron'; font-weight: bold;">NEUER KRISTALL (<span id="buy-price">10</span> ü™ô)</button>
</div>

<div id="upgrade-section">
    <h3 style="color: var(--neon)">TERRAFORMING (30)</h3>
    <div id="upgrade-list"></div>
</div>

<script>
    let money = 0;
    let gps = 0;
    let clickPower = 1;
    let crystalBasePrice = 10;
    let crystalCount = 0;
    let grid = Array(16).fill(null);
    let selectedIdx = null;
    let activeUpgrades = {};

    // Definition der 30 Upgrades
    const upgradeData = [
        {id:'u1', name:'Samen streuen', desc:'+1 Klick-Power & zeigt B√§ume', cost:15, type:'click', val:1, visual:'üå≥'},
        {id:'u2', name:'K√ºstenlinie', desc:'+5% GPS & zeigt Ozean', cost:100, type:'gps_mult', val:1.05, visual:'ocean'},
        {id:'u3', name:'Wolkenmaschine', desc:'+2 GPS & zeigt Wolken', cost:500, type:'gps', val:2, visual:'‚òÅÔ∏è'},
        {id:'u4', name:'Vulkan-Filter', desc:'Kristallpreis -10%', cost:2000, type:'discount', val:0.9, visual:'üåã'},
        {id:'u5', name:'Tiefenbohrung', desc:'GPS +20', cost:8000, type:'gps', val:20, visual:'‚õèÔ∏è'},
        {id:'u6', name:'Biosph√§re', desc:'Klick-Power x2', cost:25000, type:'click_mult', val:2, visual:'‚ú®'},
        {id:'u7', name:'Ewiges Eis', desc:'GPS +150', cost:75000, type:'gps', val:150, visual:'‚ùÑÔ∏è'},
        {id:'u8', name:'Korallenriff', desc:'GPS +10%', cost:200000, type:'gps_mult', val:1.1, visual:'ü™∏'},
        {id:'u9', name:'Atmosph√§ren-Schild', desc:'Klick-Power +50', cost:500000, type:'click', val:50, visual:'üõ°Ô∏è'},
        {id:'u10', name:'Tektonik-Stabilisator', desc:'Kristallpreis -20%', cost:1500000, type:'discount', val:0.8, visual:'‚öôÔ∏è'},
        // ... (Logik f√ºr 30 Upgrades wird prozedural gef√ºllt)
    ];

    // Erzeuge restliche Upgrades automatisch f√ºr das Beispiel
    for(let i=11; i<=30; i++) {
        upgradeData.push({
            id: 'u'+i, 
            name: `Terra-Stufe ${i}`, 
            desc: `Massiver Boost f√ºr Welt ${i}`, 
            cost: Math.pow(10, i/2) * 500, 
            type: i%2===0 ? 'gps' : 'click', 
            val: i*10,
            visual: 'üöÄ'
        });
    }

    function createCrystalHTML(lvl) {
        const hue = (lvl * 137) % 360; // Goldener Schnitt f√ºr Farben
        const corners = 3 + (lvl % 8); // √Ñndert die Eckenanzahl (3-kantig, 4-kantig...)
        const size = 40 + (lvl % 20);
        const rotation = lvl * 15;
        
        return `<div class="crystal" style="
            width: ${size}px; height: ${size}px;
            background: hsl(${hue}, 80%, 50%);
            clip-path: polygon(${getPolygonPath(corners)});
            box-shadow: 0 0 20px hsl(${hue}, 80%, 50%);
            transform: rotate(${rotation}deg);
        "><span>${lvl}</span></div>`;
    }

    function getPolygonPath(n) {
        let points = [];
        for(let i=0; i<n; i++) {
            let x = 50 + 50 * Math.cos(2 * Math.PI * i / n);
            let y = 50 + 50 * Math.sin(2 * Math.PI * i / n);
            points.push(`${x}% ${y}%`);
        }
        return points.join(',');
    }

    function renderWorld() {
        const overlay = document.getElementById('visual-overlay');
        const ocean = document.getElementById('ocean');
        overlay.innerHTML = '';
        
        if(activeUpgrades['u2']) ocean.style.opacity = "1";

        Object.keys(activeUpgrades).forEach(id => {
            const up = upgradeData.find(u => u.id === id);
            if(up.visual && up.visual !== 'ocean') {
                for(let i=0; i<3; i++) {
                    const el = document.createElement('div');
                    el.className = 'visual-element';
                    el.innerText = up.visual;
                    el.style.left = (20 + Math.random() * 60) + "%";
                    el.style.top = (20 + Math.random() * 60) + "%";
                    overlay.appendChild(el);
                }
            }
        });
    }

    function buyUpgrade(up) {
        let cost = Math.floor(up.cost);
        if(money >= cost) {
            money -= cost;
            activeUpgrades[up.id] = true;
            if(up.type === 'click') clickPower += up.val;
            if(up.type === 'click_mult') clickPower *= up.val;
            if(up.type === 'discount') crystalBasePrice *= up.val;
            renderWorld();
            updateUI();
        }
    }

    function updateUI() {
        document.getElementById('money-display').innerText = Math.floor(money).toLocaleString() + " ü™ô";
        document.getElementById('gps-display').innerText = "Produktion: " + Math.floor(gps).toLocaleString() + "/s";
        document.getElementById('buy-price').innerText = Math.floor(crystalBasePrice * Math.pow(1.2, crystalCount)).toLocaleString();
        
        const list = document.getElementById('upgrade-list');
        list.innerHTML = '';
        upgradeData.forEach(up => {
            if(activeUpgrades[up.id]) return;
            const card = document.createElement('div');
            card.className = `upgrade-card ${money < up.cost ? 'locked' : ''}`;
            card.innerHTML = `<strong>${up.name}</strong><br><small>${up.desc}</small><br><span class="price">${Math.floor(up.cost).toLocaleString()} ü™ô</span>`;
            card.onclick = () => buyUpgrade(up);
            list.appendChild(card);
        });
    }

    function handleSlotClick(i) {
        if(selectedIdx === null) {
            if(grid[i]) selectedIdx = i;
        } else {
            if(selectedIdx !== i && grid[selectedIdx] === grid[i] && grid[i] < 50) {
                grid[i]++;
                grid[selectedIdx] = null;
            } else {
                [grid[i], grid[selectedIdx]] = [grid[selectedIdx], grid[i]];
            }
            selectedIdx = null;
        }
        initGrid();
    }

    function initGrid() {
        const gridEl = document.getElementById('grid');
        gridEl.innerHTML = '';
        grid.forEach((val, i) => {
            const slot = document.createElement('div');
            slot.className = 'slot';
            if(i === selectedIdx) slot.style.borderColor = "var(--neon)";
            if(val) slot.innerHTML = createCrystalHTML(val);
            slot.onclick = () => handleSlotClick(i);
            gridEl.appendChild(slot);
        });
    }

    function clickEarth(e) {
        money += clickPower;
        updateUI();
    }

    function buyCrystal() {
        let price = crystalBasePrice * Math.pow(1.2, crystalCount);
        let empty = grid.indexOf(null);
        if(money >= price && empty !== -1) {
            money -= price;
            grid[empty] = 1;
            crystalCount++;
            initGrid();
            updateUI();
        }
    }

    setInterval(() => {
        let currentGps = 0;
        grid.forEach(val => { if(val) currentGps += Math.pow(5, val-1); });
        upgradeData.forEach(up => {
            if(activeUpgrades[up.id]) {
                if(up.type === 'gps') currentGps += up.val;
                if(up.type === 'gps_mult') currentGps *= up.val;
            }
        });
        gps = currentGps;
        money += gps / 10;
        updateUI();
    }, 100);

    initGrid();
    updateUI();
</script>
</body>
</html>
